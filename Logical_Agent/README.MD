# ğŸ‘ï¸â€¯LogicalAgentATÂ v3.2.0

![version](https://img.shields.io/badge/version-3.2.0-blue)
![python](https://img.shields.io/badge/python-%3E%3D3.9-blue)
![license](https://img.shields.io/badge/license-GPL--2.0-green)

*Symbolic watcher with Quantumâ€‘Tickâ€¯2.0, dynamic feature flags, Ï€â€‘groupoid topology **and now motifâ€‘change provenance**.*

---

## ğŸ“–Â Overview

`LogicalAgentAT` is the Watcher pillar of the Noor triad.
It buffers signed **QuantumTicks**, detects **motifâ€‘level changes**, manages dynamic runâ€‘time flags, and maintains a fast **Ï€â€‘groupoid unionâ€‘find** for symbolicâ€‘path equivalence.

### Core Pillars

| Pillar                    | Purpose                                                                |
| ------------------------- | ---------------------------------------------------------------------- |
| **Quantumâ€‘Tick 2.0**      | LamportÂ +Â HLC stamps, HMAC verification, perâ€‘motif ring buffers        |
| **Motifâ€‘Change Registry** | Emits `MotifChangeID` objects whenever a motif diverges, keeps lastâ€¯16 |
| **Dynamic Feature Flags** | Threadâ€‘safe toggle system; Prometheusâ€‘tracked                          |
| **Ï€â€‘Groupoid**            | Pathâ€‘identity merge / query with unionâ€‘find compression                |
| **Observability**         | Prom metrics for ticks, HMAC failures, flag flips                      |

---

## ğŸŒŸÂ Whatâ€™s new inÂ 3.2.0

| Feature                   | Description                                                                                 |
| ------------------------- | ------------------------------------------------------------------------------------------- |
| **MotifChangeIDÂ ring**    | `register_tick()` appends a changeâ€‘ID when `coherence_hash` differs from the previous tick. |
| **`get_latest_change()`** | Retrieve the most recent changeâ€‘ID for any motif.                                           |
| **Explicit ctor args**    | `hmac_secret`, `async_mode` now explicit â€” envâ€‘vars only if arg isÂ `None`.                  |
| **Mermaid refresh**       | Updated dataâ€‘flow diagram below.                                                            |

---

## ğŸ—ºï¸Â Watcher Dataâ€‘Flow

```mermaid
flowchart TD
    subgraph Watcher
        Tick[QuantumTick] --> Buffer[Perâ€‘Motif Ring<br/>128 entries]
        Buffer -->|hash differs| ChangeRing[MotifChangeID Ring<br/>16 entries]
        Tick -->|verify_hmac| HMAC{HMAC OK?}
        HMAC -->|no| Reject(â–¢ metric: hmac_fail)
    end
    style Tick fill:#e0f7ff,stroke:#0288d1
    style Buffer fill:#fff3e0,stroke:#f57c00
    style ChangeRing fill:#ede7f6,stroke:#673ab7
```

---

## âš™ï¸Â Constructor

```python
LogicalAgentAT(
    agent_id="watcher@default",
    enable_quantum_ticks=True,
    tick_buffer_size=128,
    pi_max_classes=20_000,
    hmac_secret=None,          # explicit > envâ€‘var
    async_mode=False,
    verbose=False,
)
```

*If `async_mode=True` and **anyio** is installed, the Watcher switches to asyncâ€‘safe locks.*

---

## ğŸ§©Â KeyÂ API

| Method                            | Category   | Purpose                            |
| --------------------------------- | ---------- | ---------------------------------- |
| `register_tick(motif, tick)`      | Core       | Buffer tick & maybe make changeâ€‘ID |
| `get_latest_tick(motif)`          | Core       | Most recent tick in buffer         |
| **`get_latest_change(motif)`**    | *new*      | Most recent `MotifChangeID`        |
| `set_feature(name,â€¯val)`          | Flags      | Flip a dynamic flag (Promâ€‘logged)  |
| `register_path_equivalence(a,â€¯b)` | Ï€â€‘Groupoid | Merge two symbolic paths           |
| `are_paths_equivalent(a,â€¯b)`      | Ï€â€‘Groupoid | Query equivalence                  |

---

## ğŸ› ï¸Â Quickâ€‘Start

```python
from logical_agent_at import LogicalAgentAT, QuantumTick
from quantum_ids import make_change_id

w = LogicalAgentAT(verbose=True)

# emit a pair of ticks
t1 = QuantumTick.now("Î±", agent_id="agent@demo")
w.register_tick("Î±", t1)

t2 = QuantumTick.now("Î±", agent_id="agent@demo")
w.register_tick("Î±", t2)

print("Latest change:", w.get_latest_change("Î±"))
```

---

## ğŸ“ŠÂ Prometheus metrics

| Metric                                   | Labels              | Meaning            |
| ---------------------------------------- | ------------------- | ------------------ |
| `logical_agent_ticks_total`              | `stage`,Â `agent_id` | Ticks accepted     |
| `logical_agent_tick_hmac_failures_total` | `agent_id`          | Bad HMACs          |
| `logical_agent_feature_toggles_total`    | `flag`,Â `agent_id`  | Dynamic flag flips |

---

## ğŸ”—Â Compatibility

| Module               | MinÂ Version | Interaction                       |
| -------------------- | ----------- | --------------------------------- |
| **NoorFastTimeCore** | â‰¥â€¯8.2.0     | Core reads latest `MotifChangeID` |
| **RecursiveAgentFT** | â‰¥â€¯4.2.0     | Emits ticks consumed by Watcher   |

---

## ğŸ“„Â License

GPLâ€‘2.0 â€¢ Â©â€¯2025â€¯Linaâ€¯NoorÂ /Â Noorâ€¯Researchâ€¯Collective
